<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="play-example-form : Example form including multiple checkboxes and selection" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>play-example-form</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ics-software-engineering/play-example-form">View on GitHub</a>

          <h1 id="project_title">play-example-form</h1>
          <h2 id="project_tagline">Example form including multiple checkboxes and selection</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/ics-software-engineering/play-example-form/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/ics-software-engineering/play-example-form/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="overview" class="anchor" href="#overview"><span class="octicon octicon-link"></span></a>Overview</h1>

<p><img src="https://raw.github.com/ics-software-engineering/play-example-form/master/doc/play-example-form-homepage.png" alt="screenshot"></p>

<p>This application provides an example of form processing with the following features:</p>

<ul>
<li>
<a href="http://www.webjars.org/">WebJars</a> to download dependencies.</li>
<li>
<a href="http://getbootstrap.com/2.3.2/">Twitter Bootstrap 2.3.2</a>.</li>
<li>Individual Twitter Bootstrap <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/views/bootstrap">helper templates</a> for each form control.</li>
<li>Separation of <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/views/formdata">form backing classes</a> from <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/models">model classes</a>.</li>
<li>Validation done with <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/views/formdata/StudentFormData.java#L57-123">validate()</a>, not annotations.</li>
<li>Testing with <a href="https://github.com/FluentLenium/FluentLenium">Fluentlenium</a>.</li>
</ul><p>The design of this example differs in two significant ways from the traditional Play form processing examples. </p>

<ol>
<li><p><strong>Distinct model and form classes.</strong>  Most examples of form processing in Play "overload" the 
 model classes to serve two tasks:  (1) specify the database schema structure; and 
 (2) provide the "backing class" for forms.  Requiring a single class to perform these two tasks
 appears to work well only when the models and forms are both simple and similar in structure. In this example system, the
 <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/views/formdata">views.formdata package</a> provides 
 classes for form processing, and the <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/models">models package</a> provides
 classes for database schemas. Since Play requires the backing classes for forms to have public fields,
 this separation means that model classes can have private fields, avoiding <a href="http://www.manning-sandbox.com/thread.jspa?messageID=143570&amp;#143570">well documented problems</a>. </p></li>
<li><p><strong>Explicit field constructors for Twitter Bootstrap 2.x.</strong>  The canonical recommendation for users of 
 Twitter Bootstrap 2.x is to create a single "implicit" field constructor.  The problem with this recommendation
 is that a single implicit field constructor cannot satisfy all of Twitter Bootstrap's layout
 requirements for form controls (for example, multiple checkboxes). This example illustrates
 a more general solution in which normal (i.e. "explicit") scala templates (i.e. field constructors) are defined in the 
 <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/views/bootstrap">views.bootstrap package</a> for each of the Twitter Bootstrap controls. IMHO, the 
 code is significantly easier to understand and debug for Java-based Play framework users.  </p></li>
</ol><h2>
<a name="steps-to-understanding-the-system" class="anchor" href="#steps-to-understanding-the-system"><span class="octicon octicon-link"></span></a>Steps to understanding the system</h2>

<p><strong>Run the application.</strong></p>

<p>Begin by downloading the code, invoking "play run" in your shell, then retrieving http://localhost:9000 
to display the single form illustrated at the top of this page. The form displays the fields
associated with a "Student":  Name, Password, Hobbies, Level, GPA, and Majors.  Some of these
are required, some are optional. Try filling out the form in both valid and invalid ways and
pressing Submit to see what happens.</p>

<p>When you submit a valid version of the form, the system will redisplay the form with exactly the 
same data that you entered, and also show a representation of the Student model instance
created from the form values.</p>

<p><strong>Run the tests.</strong></p>

<p>Next, type "control-D" in your shell to bring down the development server, and then "play test" 
to invoke the test cases. You should get output similar to the following:</p>

<pre><code>[~/play-example-form]-&gt; play test
[info] Loading project definition from /Users/johnson/projecthosting/github/play-example-form/project
[info] Set current project to play-example-form (in build file:/Users/johnson/projecthosting/github/play-example-form/)
[info] tests.ViewTest
[info] + tests.ViewTest.testIndexPageRetrieval
[info] + tests.ViewTest.testIndexPageEmptySubmission
[info] + tests.ViewTest.testIndexPageValidSubmission
[info] + tests.ViewTest.testIndexPageFormFilledSubmission
[info] 
[info] 
[info] Total for test tests.ViewTest
[info] Finished in 0.015 seconds
[info] 4 tests, 0 failures, 0 errors
[info] Passed: : Total 4, Failed 0, Errors 0, Passed 4, Skipped 0
[success] Total time: 8 s, completed Aug 16, 2013 10:05:33 AM
</code></pre>

<p>We'll come back to this later, but this step verifies that tests run correctly in your environment.</p>

<p><strong>Review the controllers.</strong></p>

<p>Now review the controller class. <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/controllers/Application.java">Application</a>
has just two methods: getIndex() which displays the form in the index page and postIndex() that processes a form submission
from the index page. See the <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/conf/routes">routes</a> file for how this is wired up.</p>

<p>The getIndex method takes a Student ID as a parameter. If the value is 0, then an empty form is
displayed, otherwise the form is displayed pre-filled with the data associated with the Student ID.
For example, you can retrieve the data for the student with ID 1 using: http://localhost:9000/?id=1.
The system <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/models/Student.java#L168-180">instantiates a couple of students on startup</a>. </p>

<p>By looking at the controller, you can see the basic approach for either form display (HTTP GET) or 
form submission (HTTP POST):</p>

<ul>
<li><p>An instance of StudentFormData is passed to the templates for rendering. This class has public
fields as required by Play, and they are all String or List[String] because binding only works on strings.</p></li>
<li><p>Other component entities (Hobby, GradeLevel, GradePointAverage, Major) provide helper methods
to support display of their values as strings along with the student's current value(s) for
those components.</p></li>
<li><p>The <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/models/Student.java#L165-185">Student.makeInstance</a> and <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/models/Student.java#L150-162">Student.makeStudentFormData</a>
methods provide conversion between the form data and model representations of a Student.</p></li>
</ul><p><strong>Review the models.</strong></p>

<p>Skim through the <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/models">models package</a>. 
There should be no surprises; it parallels the form pretty closely.  Some things to note:</p>

<ul>
<li><p>A Student entity contains non-primitive, complex components such as a list of Hobby entities and a list of Major entities.</p></li>
<li><p>The models have private fields and getters/setters. (Sorry, I'm old school that way.)     </p></li>
</ul><p><strong>Review the views.</strong></p>

<p>The <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/views">views package</a> 
is where things get most interesting.   The <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/views/main.scala.html">main</a>
and <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/views/index.scala.html">index</a>
templates are pretty much what you'd expect. </p>

<p>Note that the main template shows how to import JQuery in case you want to use Bootstrap Javascript components.</p>

<p>The second thing to review is the <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/views/bootstrap">views.bootstrap</a>
subpackage, containing Bootstrap 2.x Scala templates for various form controls. Kudos to <a href="https://github.com/kaeawc">Jason
Pearson</a> to writing these templates and making other helpful changes; your t-shirt awaits.</p>

<p>Finally, the <a href="https://github.com/ics-software-engineering/play-example-form/tree/master/app/views/formdata">views.formdata</a>
subpackage contains the single backing class (<a href="https://github.com/ics-software-engineering/play-example-form/blob/master/app/views/formdata/StudentFormData.java">StudentFormData</a>) required for this application.
Note that the backing class consists of public fields containing the String data to be displayed/bound in the form,
as well as a validate() method that determines if the submitted form data is valid or not.</p>

<p><strong>Review the tests.</strong></p>

<p>Testing is pretty straightforward, uses <a href="https://github.com/FluentLenium/FluentLenium#what-is-fluentlenium-">Fluentlenium</a>, and implements the 
<a href="https://github.com/FluentLenium/FluentLenium/wiki/Page-Object-Pattern">page object pattern</a>.</p>

<p>Start by looking at <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/test/tests/pages/IndexPage.java">IndexPage</a>.
This class implements a bunch of methods to fill out the form and check to see whether the 
displayed form contains a success or error message. Note that most of these methods depend upon
finding an HTML element with a specific ID, and so the Bootstrap Scala templates need to make
sure these ID fields are set correctly.</p>

<p>The actual test code is in <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/test/tests/ViewTest.java">ViewTest</a>.
There are four tests: one that just checks that we can retrieve the page, one that tests that
submitting an empty form generates a validation error, one that submits a form filled out 
from a valid Student ID, and a final one that fills out a valid form manually by using the 
IndexPage methods. </p>

<p>Getting tests to work exposes an unfortunate library versioning issue: HTMLUnit requires 
a version of JQuery no later than 1.8.3, while recent versions of Twitter Bootstrap 
have a Maven dependency of JQuery 1.9.0.  <a href="https://github.com/ics-software-engineering/play-example-form/blob/master/project/Build.scala#L17-19">Build.scala</a>
illustrates how to load a newer version of Bootstrap with an older, HTMLUnit-compliant version of JQuery.</p>

<h2>
<a name="issues" class="anchor" href="#issues"><span class="octicon octicon-link"></span></a>Issues</h2>

<p>While this code works and is pretty easy to understand, there are at least two design problems with it
that I can see:</p>

<ul>
<li><p><strong>Verbosity.</strong>  It's kind of a drag to have two representations for a Student, one as a model and
one as a backing class for forms.   I know that I presented this as a feature, but at the end
of the day it's born of necessity.  Perhaps there exists an elegant way to implement composite entities
(i.e. a Student that contains a List of Hobbies) in which display, binding, and validation
can be done easily and understandably with a single class.</p></li>
<li><p><strong>Integrity.</strong>  The code provides validation in the StudentFormData class, and certain
methods (such as Student.makeInstance) must assume that they are being passed a valid
StudentFormData instance.  That kind of assumption is worrisome, and annotation-based 
constraints could avoid it.  Annotation-based constraints also offer the potential
to simultaneously apply to both the database model and the form validation, which would be really
nice.  As a first step, I played around for a while with <a href="http://www.playframework.com/documentation/2.0/JavaForms">Custom Data Binding</a>,
but could not get it to work correctly for lists of Hobbies.</p></li>
</ul><p>If you see ways to solve these problems, please feel free to fork this code and implement your changes. </p>

<h2>
<a name="acknowledgements" class="anchor" href="#acknowledgements"><span class="octicon octicon-link"></span></a>Acknowledgements</h2>

<p>This example is a descendent of the original <a href="https://github.com/philipmjohnson/play-form-kludge/tree/original">play-form-kludge</a>
and <a href="https://github.com/kaeawc">Jason Pearson</a>'s <a href="https://github.com/philipmjohnson/play-form-kludge">very helpful improvements</a>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">play-example-form maintained by <a href="https://github.com/ics-software-engineering">ics-software-engineering</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
